---
import Layout from '../layouts/Layout.astro';
import Webcam from '../components/Webcam.astro';
import ControlPanel from '../components/ControlPanel.astro';
---
<Layout>
	<div class="camera-and-options">
		<Webcam/>
		<ControlPanel/>
	</div>


</Layout>

<style>
	.camera-and-options {
		display: flex;
		flex-direction: row;
		justify-content:space-between;
		overflow: hidden;

		width: 100%;
		gap: 1rem;
	}

	@media (max-width:960px) {
        .camera-and-options {
            flex-direction: column;
        }
    }

</style>

<script>
	const video = document.getElementById('webcam') as HTMLVideoElement;
    const button = document.getElementById('startCapturing') as HTMLButtonElement;

	// Creating a canvas element to draw the video frame
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d') as CanvasRenderingContext2D;

    button.addEventListener('click', () => {
		const selected = document.querySelector('input[name="letter"]:checked') as HTMLInputElement;
		if (!selected) {
			alert('Please select a letter');
			return;
		}
		const letter = selected.value;

        canvas.width  = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0);

		// Convert to blob and download
        canvas.toBlob((blob) => {
            if (!blob) return;
			const extension = blob.type.split('/')[1] || 'png';
			const id = crypto.randomUUID().split('-')[0];
			const filename = `${letter}_${id}.${extension}`;
			
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }, 'image/png');
    });
</script>